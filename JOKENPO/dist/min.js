const CONFIGS={amount:250,speed:2,withDvd:false,withEvolutions:false,};const randomInt=(min,max)=>Math.floor(Math.random()*(max-min+1)+min);const getPointDistance=(point1,point2)=>Math.sqrt((point1.x-point2.x)**2+(point1.y-point2.y)**2);const movePointTowards=(point,targetPoint,distance,speed)=>{const normalizedDirection={x:(targetPoint.x-point.x)/distance,y:(targetPoint.y-point.y)/distance,};return{x:point.x+normalizedDirection.x*speed,y:point.y+normalizedDirection.y*speed,};};const battleContainer=document.getElementById("battle-container");const battleRect=battleContainer.getBoundingClientRect();const ENTITY_TYPES={ROCK:"rock",PAPER:"paper",SCISSOR:"scissor",WATER:"water",LOG:"log",FIRE:"fire",};const ENTITIES=({[ENTITY_TYPES.ROCK]:{group:ENTITY_TYPES.ROCK,type:ENTITY_TYPES.ROCK,kills:[ENTITY_TYPES.SCISSOR],speed:1,evolution:{minKills:7,evolution:ENTITY_TYPES.WATER},},[ENTITY_TYPES.PAPER]:{group:ENTITY_TYPES.PAPER,type:ENTITY_TYPES.PAPER,kills:[ENTITY_TYPES.ROCK],speed:1,evolution:{minKills:7,evolution:ENTITY_TYPES.LOG},},[ENTITY_TYPES.SCISSOR]:{group:ENTITY_TYPES.SCISSOR,type:ENTITY_TYPES.SCISSOR,kills:[ENTITY_TYPES.PAPER],speed:1,killsToEvolve:7,evolution:{minKills:7,evolution:ENTITY_TYPES.FIRE},},[ENTITY_TYPES.WATER]:{group:ENTITY_TYPES.ROCK,type:ENTITY_TYPES.WATER,kills:[ENTITY_TYPES.PAPER,ENTITY_TYPES.SCISSOR,ENTITY_TYPES.FIRE],speed:2,},[ENTITY_TYPES.LOG]:{group:ENTITY_TYPES.PAPER,type:ENTITY_TYPES.LOG,kills:[ENTITY_TYPES.ROCK,ENTITY_TYPES.SCISSOR,ENTITY_TYPES.WATER],speed:2,},[ENTITY_TYPES.FIRE]:{group:ENTITY_TYPES.SCISSOR,type:ENTITY_TYPES.FIRE,kills:[ENTITY_TYPES.ROCK,ENTITY_TYPES.PAPER,ENTITY_TYPES.LOG],speed:2,},});let entitiesList=([]);const initEntities=()=>{entitiesList=[];for(let i=0;i<CONFIGS.amount;i++){entitiesList.push(createEntity(ENTITIES[ENTITY_TYPES.ROCK]));entitiesList.push(createEntity(ENTITIES[ENTITY_TYPES.PAPER]));entitiesList.push(createEntity(ENTITIES[ENTITY_TYPES.SCISSOR]));}};const entitiesTouching=(entityA,entityB)=>{return(((entityA.pointTop.x>=entityB.pointTop.x&&entityA.pointTop.x<=entityB.pointBottom.x)||(entityB.pointTop.x>=entityA.pointTop.x&&entityB.pointTop.x<=entityA.pointBottom.x))&&((entityA.pointTop.y>=entityB.pointTop.y&&entityA.pointTop.y<=entityB.pointBottom.y)||(entityB.pointTop.y>=entityA.pointTop.y&&entityB.pointTop.y<=entityA.pointBottom.y)));};const killEntity=(entity)=>{if(!entity.element)return;removeEntity(entity);entity.element=null;entitiesList.splice(entitiesList.indexOf(entity),1);};const evolveEntity=(entity)=>{if(!entity.evolution||!CONFIGS.withEvolutions)return;if(entity.killCount>=entity.evolution.minKills){let source=ENTITIES[entity.evolution.evolution];if(source){Object.assign(entity,source);setEntityType(entity);}}};const entityKillEntity=(entityA,entityB)=>{killEntity(entityB);entityA.killCount=(entityA.killCount||0)+1;evolveEntity(entityA);};const getClosestTarget=(entity,entities)=>{let minDistance=Infinity;let selectedTarget=(null);entities.forEach((targetEntity)=>{entity.kills.forEach((t)=>{if(targetEntity.type===t){const distance=getPointDistance(entity.pointTop,targetEntity.pointTop);if(distance<minDistance){selectedTarget=targetEntity;minDistance=distance;}}});});return{target:selectedTarget,distance:minDistance};};const checkTouches=()=>{const freshEntities=[...entitiesList];freshEntities.forEach((entityA)=>{if(!entityA.element)return;freshEntities.forEach((entityB)=>{if(!entityB.element)return;if(entityA!==entityB&&entityA.type!==entityB.type&&entitiesTouching(entityA,entityB)){if(entityA.kills.includes(entityB.type))entityKillEntity(entityA,entityB);if(entityB.kills.includes(entityA.type))entityKillEntity(entityB,entityA);}});});};const moveEntities=()=>{checkTouches();entitiesList.forEach((entity)=>{const{target,distance}=getClosestTarget(entity,entitiesList);if(!target)return;setEntityPoint(entity,movePointTowards(entity.pointTop,target.pointTop,distance,(entity.speed*CONFIGS.speed*entity.size)/20));});};const getEntitySize=()=>Math.sqrt((battleRect.width*battleRect.height)/CONFIGS.amount)/3;const setEntityPoint=(entity,point)=>{entity.element.style.setProperty("--entity-top",`${point.y}px`);entity.element.style.setProperty("--entity-left",`${point.x}px`);entity.pointTop=point;entity.pointBottom={x:point.x+entity.size,y:point.y+entity.size};};const setEntityType=(entity)=>{if(!entity.element)return;entity.element.className=`image`;entity.element.classList.add(entity.type);};const createEntity=(baseEntity)=>{const entitySize=getEntitySize();const element=document.createElement("DIV");element.style.setProperty("--entity-size",`${entitySize}px`);battleContainer.appendChild(element);const entity={...baseEntity,element,size:entitySize};setEntityType(entity);setEntityPoint(entity,{x:randomInt(0,battleRect.width-entitySize),y:randomInt(0,battleRect.height-entitySize),});return entity;};const removeEntity=(entity)=>{battleContainer.removeChild(entity.element);};const clearArena=()=>{battleContainer.innerHTML="";};const dvdEntity=({kills:[ENTITY_TYPES.ROCK,ENTITY_TYPES.PAPER,ENTITY_TYPES.SCISSOR,ENTITY_TYPES.WATER,ENTITY_TYPES.LOG,ENTITY_TYPES.FIRE,],speed:10,});const dvdColors=["red","blue","green","purple","orange"];const setDvdClass=()=>{dvdEntity.element.className=`image dvd ${dvdColors[Math.floor(Math.random()*dvdColors.length)]}`;};const initDvd=()=>{const entitySize=150;const element=document.createElement("DIV");element.style.setProperty("--entity-size",`${entitySize}px`);battleContainer.appendChild(element);dvdEntity.size=entitySize;dvdEntity.element=element;dvdEntity.speedX=dvdEntity.speedY=dvdEntity.speed;setEntityPoint(dvdEntity,{x:randomInt(0,battleRect.width-entitySize),y:randomInt(0,battleRect.height-entitySize),});setDvdClass();};const checkDvdTouch=()=>{const freshEntities=[...entitiesList];freshEntities.forEach((entity)=>{if(!entity.element)return;if(entitiesTouching(dvdEntity,entity)){entityKillEntity(dvdEntity,entity);}});};const moveDvd=()=>{checkDvdTouch();const newPoint=({x:dvdEntity.pointTop.x+dvdEntity.speedX,y:dvdEntity.pointTop.y+dvdEntity.speedY,});if(newPoint.x+dvdEntity.size>=battleRect.width||newPoint.x<=0){dvdEntity.speedX*=-1;setDvdClass();}if(newPoint.y+dvdEntity.size>=battleRect.height||newPoint.y<=0){dvdEntity.speedY*=-1;setDvdClass();}setEntityPoint(dvdEntity,newPoint);};let interval=(null);const start=()=>{clearInterval(interval);clearArena();initEntities();if(CONFIGS.withDvd)initDvd();interval=setInterval(()=>{moveEntities();if(CONFIGS.withDvd)moveDvd();const types=new Set(entitiesList.map((e)=>e.group));if(types.size===1){console.log(`${[...types][0].toUpperCase()}S WINS!`);clearInterval(interval);}},50);};start();const settingsContainer=document.getElementById("settings-container");const settingsInputs=({});Object.keys(CONFIGS).forEach((prop)=>{const input=document.createElement("input");switch(typeof CONFIGS[prop]){case"number":input.type="number";input.value=`${CONFIGS[prop]}`;break;case"boolean":input.type="checkbox";input.checked=CONFIGS[prop];break;}input.id=`config-${prop}`;settingsInputs[prop]=input;const label=document.createElement("label");label.htmlFor=input.id;label.textContent=prop;label.appendChild(input);settingsContainer.appendChild(label);});const startButton=document.createElement("button");startButton.innerHTML="START";startButton.onclick=()=>{Object.keys(CONFIGS).forEach((prop)=>{console.log(prop,typeof CONFIGS[prop],CONFIGS[prop]);switch(typeof CONFIGS[prop]){case"number":CONFIGS[prop]=+settingsInputs[prop].value;break;case"boolean":CONFIGS[prop]=settingsInputs[prop].checked;break;}console.log("depois",typeof CONFIGS[prop],CONFIGS[prop]);});start();};settingsContainer.appendChild(startButton);